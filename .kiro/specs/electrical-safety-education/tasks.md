# 구현 계획 (Implementation Plan)

## 🚀 1단계: 프로젝트 기초 구조 및 프론트엔드 설정

- [ ] 1.1 프로젝트 기본 파일 구조 생성
  - 루트 폴더에 index.html, styles.css, script.js 파일 생성
  - api/ 폴더 생성 (백엔드 서버리스 함수용)
  - .gitignore 파일 생성 (.env, Google Cloud 키 파일 등 민감 정보 제외)
  - _요구사항: 8.1, 보안 체크리스트_

- [ ] 1.2 HTML 기본 구조 작성
  - 5개 화면을 위한 div 요소들을 ID와 함께 생성 (user-info, fortune, video, assessment, completion)
  - 각 화면별 필요한 폼 요소들과 버튼들 마크업
  - 한글 메타 태그 및 반응형 뷰포트 설정
  - _요구사항: 1.1, 2.1, 3.1, 4.1, 5.1_

- [ ] 1.3 CSS 스타일링 및 화면 전환 시스템
  - .screen 클래스와 .screen.active 스타일 정의
  - 화면 전환 애니메이션 효과 구현
  - 반응형 디자인 기본 레이아웃 설정
  - 한글 폰트 및 UI 컴포넌트 스타일링
  - _요구사항: 8.1, 8.5, 배포 체크리스트_

- [ ] 1.4 JavaScript SPA 네비게이션 시스템
  - screenManager 객체 구현 (showScreen, validateCurrentScreen 메서드)
  - 화면 간 부드러운 전환 기능 구현
  - 사용자 세션 데이터 관리 객체 생성
  - _요구사항: 8.1, 8.3_

## 🎯 2단계: 사용자 정보 입력 및 운세 화면 구현

- [ ] 2.1 사용자 정보 입력 화면 완성
  - 이름 입력 필드와 12지신 드롭다운 메뉴 구현
  - 클라이언트 사이드 유효성 검사 (한글 오류 메시지)
  - "다음" 버튼 클릭 시 API 호출 및 화면 전환 로직
  - _요구사항: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_

- [ ] 2.2 운세 및 로또 번호 화면 구현
  - 12지신별 운세 콘텐츠 데이터 구조 생성
  - 1-45 범위 로또 번호 6개 랜덤 생성 기능
  - "안전교육 시작" 버튼으로 다음 화면 전환
  - 시각적으로 매력적인 UI 디자인 적용
  - _요구사항: 2.1, 2.2, 2.3, 2.4_

- [ ] 2.3 첫 번째 배포 및 테스트
  - Vercel에 프론트엔드 배포
  - 화면 전환 및 기본 기능 동작 확인
  - 모바일/데스크톱 반응형 테스트
  - _배포 체크리스트: 1-3단계 항목 모두 확인_

## 🎬 3단계: 영상 교육 및 평가 화면 구현

- [ ] 3.1 YouTube Privacy-Enhanced 영상 교육 화면 구현
  - YouTube Privacy-Enhanced 모드 (youtube-nocookie.com) 영상 임베드
  - 개인정보 보호 강화된 플레이어 설정 및 쿠키 최소화
  - 영상 재생 완료 감지 시스템 (YouTube API 활용)
  - "시청 완료" 버튼 조건부 표시 로직
  - 영상 완료 전 화면 이동 방지 기능
  - Privacy-Enhanced 임베드 실패 시 수동 완료 옵션 제공
  - _요구사항: 9.1, 9.2, 9.3, 9.4, 9.5, 9.6_

- [ ] 3.2 교육 평가 퀴즈 화면 구현
  - 4지선다 객관식 문제 2개 UI 구성
  - 답변 선택 및 수정 가능한 인터페이스
  - 모든 문제 답변 완료 시 버튼 활성화
  - 퀴즈 응답 데이터 세션 저장
  - _요구사항: 4.1, 4.2, 4.3, 4.4, 4.5_

## 🎲 4단계: 백엔드 API 및 행운 이벤트 구현

- [ ] 4.1 사용자 정보 저장 API 구현
  - /api/start-education 서버리스 함수 생성
  - Google Sheets API 연동 (환경 변수 사용)
  - 입력 데이터 유효성 검사 및 정제
  - 오류 처리 및 응답 포맷팅
  - _요구사항: 1.4, 7.1, 7.2, 7.3_

- [ ] 4.1.1 AI 기반 맞춤형 운세 생성 API 구현 ⭐ **새로 추가**
  - /api/generate-fortune 서버리스 함수 생성
  - Claude(Anthropic) API 연동으로 개인화된 운세 생성
  - 제철소 전기설비 정비자를 위한 맞춤형 프롬프트 설계
  - 환경 변수로 CLAUDE_API_KEY 안전 관리
  - AI 호출 실패 시 기본 운세 제공하는 fallback 로직
  - 사용자 이름과 띠 정보를 활용한 개인화
  - _요구사항: 2.1, 7.1, 7.2, 7.3, AI 맞춤형 콘텐츠_

- [ ] 4.2 당첨자 수 확인 API 구현
  - /api/check-winners 서버리스 함수 생성
  - Google Sheets에서 현재 당첨자 수 조회
  - 100명 한도 검증 로직
  - 당첨 가능 여부 상태 반환
  - _요구사항: 5.2, 5.3_

- [ ] 4.3 행운 이벤트 화면 구현
  - "행운 버튼" UI 및 클릭 핸들러
  - 10% 확률 당첨 계산 로직
  - 당첨/꽝 결과 팝업 모달 (한글 메시지)
  - 7자리 사번 입력 필드 및 유효성 검사
  - _요구사항: 5.1, 5.4, 5.5, 5.6, 6.1, 6.2_

## 📊 5단계: 최종 데이터 저장 및 완성

- [ ] 5.1 최종 데이터 저장 API 구현
  - /api/complete-education 서버리스 함수 생성
  - 모든 수집 데이터 종합 유효성 검사
  - Google Sheets 행 업데이트 기능
  - 성공/실패 응답 및 오류 처리
  - _요구사항: 6.3, 6.4, 6.5, 6.6, 7.1, 7.2, 7.3_

- [ ] 5.2 종합 오류 처리 및 사용자 피드백
  - 모든 API 호출에 대한 네트워크 오류 처리
  - 한글 사용자 친화적 오류 메시지
  - 로딩 상태 및 시각적 피드백
  - 실패 시 재시도 기능
  - _요구사항: 8.3, 8.4, 7.4_

- [ ] 5.3 세션 관리 및 데이터 지속성
  - 사용자 세션 객체로 전체 플로우 상태 관리
  - 중요 데이터 로컬 스토리지 백업
  - 세션 복구 기능 구현
  - 전체 애플리케이션 데이터 검증 및 정제
  - _요구사항: 7.4, 8.1_

## 🔄 6단계: 백업 시스템 및 마이그레이션 준비

- [ ] 6.1 자동 백업 시스템 구현
  - 타임스탬프 기반 백업 디렉토리 생성 스크립트 작성
  - 현재 netlify/functions/ 폴더 전체 백업 기능
  - 환경 변수 및 설정 파일 백업 (암호화된 형태로 저장)
  - package.json, netlify.toml 등 설정 파일 백업
  - 백업 무결성 검증 및 복원 테스트 스크립트
  - _요구사항: 10.1, 10.2, 10.3, 10.4_

- [ ] 6.2 백엔드 인프라 변경 대비 마이그레이션 도구
  - 기존 Netlify Functions에서 다른 플랫폼으로 이전 시 필요한 변환 스크립트
  - 환경 변수 매핑 및 변환 도구 구현
  - 데이터베이스 연결 설정 보존 및 이전 기능
  - 복원 절차 문서화 및 자동화 스크립트
  - _요구사항: 10.2, 10.5, 10.6_

## 🚀 7단계: 최종 배포 및 보안 검증

- [ ] 7.1 보안 및 환경 설정 최종 점검
  - 모든 API 키와 민감 정보가 환경 변수로 설정되었는지 확인
  - 코드에 하드코딩된 비밀 정보가 없는지 검증
  - Google Sheets 권한이 서비스 계정에만 부여되었는지 확인
  - .gitignore에 모든 민감 파일이 포함되었는지 점검
  - YouTube Privacy-Enhanced 설정 보안 검증
  - _요구사항: 7.1, 7.2, 7.3, 9.6, 배포 체크리스트 보안 항목_

- [ ] 7.2 종합 테스트 및 검증
  - 전체 사용자 플로우 처음부터 끝까지 테스트
  - 다양한 입력 시나리오로 API 엔드포인트 검증
  - YouTube Privacy-Enhanced 영상 통합 및 재생 제어 기능 테스트
  - 행운 이벤트 로직 및 당첨자 할당량 기능 검증
  - 다양한 기기 및 브라우저에서 반응형 디자인 테스트
  - 백업 및 복원 시스템 동작 검증
  - _요구사항: 모든 요구사항 검증_

- [ ] 7.3 프로덕션 환경 배포 및 설정
  - Netlify 배포 설정 구성 (기존 Vercel에서 변경)
  - Google Sheets API용 환경 변수 설정
  - 실제 데이터 플로우로 프로덕션 배포 테스트
  - 보안 조치 및 API 키 보호 검증
  - YouTube Privacy-Enhanced 모드 프로덕션 환경 테스트
  - 백업 시스템 프로덕션 환경 적용 및 테스트
  - 최종 사용자 테스트 및 성능 확인
  - _요구사항: 7.1, 7.2, 7.3, 9.1-9.6, 10.1-10.6, 배포 체크리스트 4-5단계 항목_

## 📋 각 단계별 배포 체크리스트 적용

**1-3단계 완료 후 중간 배포 시:**
- [ ] HTML 구조 완성도 확인
- [ ] CSS 화면 전환 스타일 적용 확인  
- [ ] JavaScript 화면 전환 기능 동작 확인
- [ ] Vercel 배포 URL 접속 및 화면 표시 확인

**4-5단계 완료 후 최종 배포 시:**
- [ ] API 파일들이 api/ 폴더에 올바르게 위치 확인
- [ ] fetch API 호출 주소 정확성 확인
- [ ] Vercel 환경 변수 모든 비밀 값 설정 확인 ⭐ **CLAUDE_API_KEY 포함**
- [ ] Google Sheets 서비스 계정 편집자 권한 확인
- [ ] AI 운세 생성 API 정상 동작 테스트 ⭐ **새로 추가**
- [ ] 배포된 웹사이트 전체 기능 실제 데이터 연동 테스트

**매 배포 전 공통 확인사항:**
- [ ] 모든 수정 파일 저장 완료
- [ ] 로컬 환경에서 기능 정상 동작 확인
- [ ] 코드 내 API 키, 비밀번호 등 민감 정보 직접 기재 여부 점검
- [ ] .gitignore 파일에 민감 파일들 추가 확인
- [ ] git status로 커밋 대상 파일들 최종 확인